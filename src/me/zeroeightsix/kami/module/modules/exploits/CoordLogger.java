// 
// Decompiled by Procyon v0.5.36
// 

package me.zeroeightsix.kami.module.modules.exploits;

import me.zeroeightsix.kami.util.FileHelper;
import me.zeroeightsix.kami.command.Command;
import java.util.Iterator;
import java.util.List;
import net.minecraft.entity.player.EntityPlayer;
import java.util.function.Predicate;
import net.minecraft.network.play.server.SPacketEffect;
import com.mojang.realmsclient.gui.ChatFormatting;
import net.minecraft.init.SoundEvents;
import net.minecraft.util.SoundCategory;
import net.minecraft.network.play.server.SPacketSoundEffect;
import me.zeroeightsix.kami.setting.Settings;
import net.minecraft.util.math.Vec3d;
import net.minecraft.entity.Entity;
import java.util.HashMap;
import me.zero.alpine.listener.EventHandler;
import me.zeroeightsix.kami.event.events.PacketEvent;
import me.zero.alpine.listener.Listener;
import me.zeroeightsix.kami.setting.Setting;
import me.zeroeightsix.kami.module.Module;

@Info(name = "CoordLogger", description = "Coord Logger", category = Category.EXPLOITS)
public class CoordLogger extends Module
{
    private static final String fileName = "Hephaestus_CoordLogger.txt";
    private Setting<Boolean> tp;
    private Setting<Boolean> lightning;
    private Setting<Boolean> portal;
    private Setting<Boolean> wither;
    private Setting<Boolean> dragon;
    private Setting<Boolean> savetofile;
    @EventHandler
    public Listener<PacketEvent.Send> listener;
    private HashMap<Entity, Vec3d> knownPlayers;
    
    public CoordLogger() {
        this.tp = this.register(Settings.b("TpExploit", false));
        this.lightning = this.register(Settings.b("Thunder", false));
        this.portal = this.register(Settings.b("EndPortal", false));
        this.wither = this.register(Settings.b("Wither", false));
        this.dragon = this.register(Settings.b("Dragon", false));
        this.savetofile = this.register(Settings.b("SaveToFile", false));
        SPacketSoundEffect packet;
        SPacketEffect packet2;
        this.listener = new Listener<PacketEvent.Send>(event -> {
            if (this.lightning.getValue() && event.getPacket() instanceof SPacketSoundEffect) {
                packet = (SPacketSoundEffect)event.getPacket();
                if (packet.func_186977_b() == SoundCategory.WEATHER && packet.func_186978_a() == SoundEvents.field_187754_de) {
                    this.sendNotification("[CoordLogger]: " + ChatFormatting.RED.toString() + "Lightning spawned at X" + packet.func_149207_d() + " Z" + packet.func_149210_f());
                }
            }
            if (event.getPacket() instanceof SPacketEffect) {
                packet2 = (SPacketEffect)event.getPacket();
                if (this.portal.getValue() && packet2.func_149242_d() == 1038) {
                    this.sendNotification("[CoordLogger]: " + ChatFormatting.RED.toString() + "End Portal activated at X" + packet2.func_179746_d().func_177958_n() + " Y" + packet2.func_179746_d().func_177956_o() + " Z" + packet2.func_179746_d().func_177952_p());
                }
                if (this.wither.getValue() && packet2.func_149242_d() == 1023) {
                    this.sendNotification("[CoordLogger]: " + ChatFormatting.RED.toString() + "Wither spawned at X" + packet2.func_179746_d().func_177958_n() + " Y" + packet2.func_179746_d().func_177956_o() + " Z" + packet2.func_179746_d().func_177952_p());
                }
                if (this.dragon.getValue() && packet2.func_149242_d() == 1028) {
                    this.sendNotification("[CoordLogger]: " + ChatFormatting.RED.toString() + "Dragon killed at X" + packet2.func_179746_d().func_177958_n() + " Y" + packet2.func_179746_d().func_177956_o() + " Z" + packet2.func_179746_d().func_177952_p());
                }
            }
            return;
        }, (Predicate<PacketEvent.Send>[])new Predicate[0]);
        this.knownPlayers = new HashMap<Entity, Vec3d>();
    }
    
    @Override
    public void onUpdate() {
        if (!this.tp.getValue()) {
            return;
        }
        final List<Entity> tickEntityList = (List<Entity>)CoordLogger.mc.field_71441_e.func_72910_y();
        for (final Entity entity : tickEntityList) {
            if (entity instanceof EntityPlayer && !entity.func_70005_c_().equals(CoordLogger.mc.field_71439_g.func_70005_c_())) {
                final Vec3d targetPos = new Vec3d(entity.field_70165_t, entity.field_70163_u, entity.field_70161_v);
                if (this.knownPlayers.containsKey(entity)) {
                    if (Math.abs(CoordLogger.mc.field_71439_g.func_174791_d().func_72438_d(targetPos)) >= 128.0 && this.knownPlayers.get(entity).func_72438_d(targetPos) >= 64.0) {
                        this.sendNotification("[CoordLogger]: " + ChatFormatting.RED.toString() + "Player " + entity.func_70005_c_() + " moved to Position " + targetPos.toString());
                    }
                    this.knownPlayers.put(entity, targetPos);
                }
                else {
                    this.knownPlayers.put(entity, targetPos);
                }
            }
        }
    }
    
    private void sendNotification(final String s) {
        Command.sendChatMessage(s);
        if (this.savetofile.getValue()) {
            FileHelper.appendTextFile(s, "AstraMod_CoordLogger.txt");
        }
    }
}
